<!doctype html>
<html>
<head>
    <title>Singapore Map - Tourist Attractions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <link rel="stylesheet" type="text/css" href="./css/icon.css" />
    <link rel="stylesheet" type="text/css" href="./css/label.css" />
    <script src="./js/map-style.js"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@googlemaps/markerwithlabel/dist/index.min.js"></script>

    <!-- Call Google Map JS API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhxal3J4QPdqzueExcY1fVz25q9MByoH0"></script>
</head>

<body>
    <div class="container custom-container">
        <div class="flex-container">
            <!-- Dashboard Menu -->
            <div class="flex-col menu-bar">
                <div class="card-box flex-col menu-item text-white ts-12 centered-content selected">
                    <span class="icon-md db-icon-1"></span>
                    Browser
                </div>
                <div class="card-box flex-col menu-item text-secondary ts-12 centered-content">
                    <span class="icon-md db-icon-2"></span>
                    Suggest<br>Attractions
                </div>
                <div class="card-box flex-col menu-item text-secondary ts-12 centered-content">
                    <span class="icon-md db-icon-3"></span>
                    Videos
                </div>
                <div class="card-box flex-col menu-item text-secondary ts-12 centered-content">
                    <span class="icon-md db-icon-4"></span>
                    Blog
                </div>
                <div class="card-box flex-col menu-item text-secondary ts-12 centered-content">
                    <span class="icon-md db-icon-5"></span>
                    About
                </div>
            </div>
            <!-- Sidenav Bar Menu -->
            <div class="flex-col sidenav">
                <div class="card-box btn-group centered-content">
                    <button class="btn btn-secondary custom-btn-scd dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                      Filter by favorite
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <li><a class="dropdown-item text-dark" href="#">Most Popular</a></li>
                    </ul>
                </div>
                <button class="dropdown-btn sidenav-item ts">Merlion</button>
                <button class="dropdown-btn dropdown-toggle sidenav-item ts">Marina Bay Sands</button>
                <div class="dropdown-container dropdown-content">
                    <a class="ts" href="#">ArtScience Museum</a>
                    <a class="ts" href="#">Marina Bay Sands Skypark</a>
                    <a class="ts" href="#">Double Helix Bridge</a>
                </div>
                <button class="dropdown-btn dropdown-toggle sidenav-item ts">Garden by the Bay</button>
                <button class="dropdown-btn dropdown-toggle sidenav-item ts">China Town</button>  
                <button class="dropdown-btn sidenav-item ts" href="#asian-civilations-museums">Asian Civilitasions Museum</button>
                <button class="dropdown-btn sidenav-item ts" href="#clarke-quay">Clarke Quay</button>
                <button class="dropdown-btn sidenav-item ts" href="#fort-canning-park">Fort Canning Park</button>
                <button class="dropdown-btn sidenav-item ts" href="#singapore-flyer">Singapore Flyer</button>
                <button class="dropdown-btn sidenav-item ts" href="#orchard-road">Orchard Road</button>
            </div>
            <!-- Map Viewer Side -->
            <div class="map-container">
                <!-- Header Map -->
                <div class="flex-col header-bar">
                    <h4 class="title">TOP RATED TOURIST ATTRACTIONS IN SINGAPORE</h4>
                    <div class="icons flex-row top-50 end-0 translate-middle-y">
                        <span class="icon-sm hr-icon-1"></span>
                        <span class="icon-sm hr-icon-2"></span>
                        <span class="icon-sm hr-icon-3"></span>
                    </div>
                </div>
                <!-- Map Body -->
                <div class="map-body">
                    <div id="googleMap"></div>
                    <div class="side-map-info position-absolute bottom-0 end-0" id="side-map-info" style="display: none;">
                        <div class="img-container">
                            <img id="image">
                            <div class="close position-absolute top-0 end-0">
                                <i class="fas fa-times close fa-lg" onclick="sideMapInfoClose()"></i>
                            </div>
                        </div>
                        <div class="title text-white" id="title">Merlion</div>
                        <div class="desc ts" id="desc"></div>
                        <div class="address ts">
                            <i class="fas fa-map-marker-alt fa-fw" style="color: #72cdd2"></i>
                            <p id="address">Jalan Raya</p>
                        </div>
                        <div class="address ts">
                            <i class="fas fa-globe-asia fa-fw" style="color: #92d72e"></i>
                            <a id="website" href="#" class="ts ellipsis" style="color: #cccccc;">https://www.google.com</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let map, 
            marker,
            newMarker,
            dataLocation = [],
            markers = [],
            offsetValue = 0,
            xOffset = 100

        $( document ).ready( function() {
            initMap()

            // i'm using python simpleHTTPServer to bypass CORS policy in browser
            // command : python -m http.server
            $.ajax({
                type: "GET",
                url: "./js/data.json",
                success: function( data, status, xhr ) {
                    let locations = data.singapore
                    let navItems = $( ".sidenav-item" )
                    
                    dataLocation = locations

                    // check if data is empty or not exist
                    if ( locations === undefined || locations.length == 0 ) {
                        console.log( "No data!" )
                    }

                    locations.forEach(( element, index ) => {
                        putMarkersOnMap( element, index )
                        navItems.eq(index).attr( "onclick", "goToMarker("+ index +")" )
                    })
                },
                error: function( xhr, status, error ) {
                    console.log( xhr.responseText )
                },
                dataType: "json" 
            })

            dropdownListOpener()
        })

        function initMap() {
            const center = new google.maps.LatLng( 1.286920, 103.854570 )
            const mapProp = {
                center: center,
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: customMapStyle,
            }
            // init map
            map = new google.maps.Map( document.getElementById( "googleMap" ), mapProp )
        }

        // to put markers on map
        function putMarkersOnMap( loc, i ) {
            let position = new google.maps.LatLng( loc.lat, loc.lng )
            let markerLabel = loc.name            
                        
            let markerIcon = {
                url: './img/geo-pin-sm.png',
                scaledSize: new google.maps.Size( 36, 57 ),
                origin: new google.maps.Point( 0, 0 ),
                anchor: new google.maps.Point( 19, 50 ) // reposition custom marker in map to fit the origin marker
            }
            
            // from MarkerWithLabel documentation
            // http://www.abzz.co/v4/js/markerlabel/docs/examples.html

            marker = new MarkerWithLabel({
                position: position,
                map: map,
                draggable: false,
                icon: markerIcon,
                labelContent: markerLabel,
                labelAnchor: new google.maps.Point( -5, -45 ), // positioning label
                labelClass: "label label-sm",
            })

            markers[i] = marker
            
            marker.addListener( 'click', function() {
                // close side map info
                $( "#side-map-info" ).attr( "style", "display:none;" ) 
                goToMarker( i )
            })
        }
        
        function addCustomMarker( pos, index ) {
            let markerLabelClicked = dataLocation[ index ].name + "<p class='sub-label'>" + dataLocation[ index ].address + "</p>"
            // reset new marker
            if (newMarker != undefined) {
                newMarker.visible = false
                newMarker.labelClass = "label-hidden"
            }

            let newMarkerIcon = {
                url: './img/geo-pin-lg.png',
                scaledSize: new google.maps.Size( 100, 150 ),
                origin: new google.maps.Point( 2, 0 ),
                anchor: new google.maps.Point( 60, 148 ) // reposition custom marker in map to fit the origin marker
            }

            newMarker = new MarkerWithLabel({
                position: pos,
                map: map,
                draggable: false,
                icon: newMarkerIcon,
                labelContent: markerLabelClicked,
                labelAnchor: new google.maps.Point( -4, -134 ),
                labelClass: "label label-lg"
            })
            
            newMarker.addListener('click', function() {
                sideMapInfoOpen( index )
            })
        }
        
        function goToMarker( index ) {
            let position = new google.maps.LatLng( dataLocation[ index ].lat, dataLocation[ index ].lng )
            // reset after click
            for ( let i = 0; i < markers.length; i ++ ) {
                if ( markers[i].visible == false ) {
                    markers[i].visible = true
                    markers[i].labelClass = "label label-sm"
                }
            }
            // close side map info
            $( "#side-map-info" ).attr( "style", "display:none;" ) 
            // pan and zoom to target
            map.panTo( position )
            map.setZoom( 17 )
            // set clicked marker to be invisible
            markers[ index ].visible = false
            markers[ index ].labelClass = "label-hidden"
            // set new custom big marker as give more information
            addCustomMarker( position, index )
            // reset xOffset for next panBy
            xOffset = 100
        }

        // side map info open handler

        function sideMapInfoOpen( index ) {
            // change center when side map opened
            map.panBy( offsetValue + xOffset, 0 )
            // make panBy to 0, 0 after click
            xOffset = 0
            // set to side map info
            $( "#side-map-info" ).attr( "style", "display:block;" )
            $( "#image" ).attr( "src", dataLocation[ index ].image )
            $( "#image" ).attr( "alt", dataLocation[ index ].name )
            $( "#title" ).text(dataLocation[ index ].name )
            $( "#desc" ).html(dataLocation[ index ].desc )
            $( "#address" ).text( dataLocation[ index ].address )
            $( "#website" ).attr( "src", dataLocation[ index ].website ).text( dataLocation[ index ].website )
        }

        function sideMapInfoClose() {
            // normal map center
            map.panBy( -100, 0 )
            // reset xOffset for next panBy
            xOffset = 100
            // close side map info
            $( "#side-map-info" ).attr( "style", "display:none;" )
        }
        
        // sidenav list controller
        // https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_active_element
        // https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_sidenav_dropdown

        function dropdownListOpener() {

            const dropdown = document.getElementsByClassName( "dropdown-btn" )
            const sideNavItem = document.getElementsByClassName( "sidenav-item" )
            
            for ( let i = 0; i < dropdown.length; i++ ) {
                dropdown[i].addEventListener( "click", function() {
                    let dropdownContent = this.nextElementSibling
                    let activeElement = document.getElementsByClassName( "active" )
                    // remove others non-clicked active class
                    if ( activeElement.length > 0 ) {
                        activeElement[0].className = activeElement[0].className.replace( " active", "" )
                    }
                    // set active class to clicked element
                    this.classList.toggle("active")
                    // open and close list from dropdown
                    if ( dropdownContent.classList.contains("dropdown-content") && dropdownContent.style.display === "block" ) {
                        dropdownContent.style.display = "none"
                    } else {
                        dropdownContent.style.display = "block"
                    }
                });
            }
        }
    </script>
</body>
</html>